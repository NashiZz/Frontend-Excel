(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3686:()=>{},2383:()=>{},2682:(e,t,a)=>{Promise.resolve().then(a.bind(a,9334))},9334:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var l=a(5155),s=a(2110),r=a(2115),n=a(1362),o=a(2651);let d=" https://backend-excel-cagd.onrender.com/api",c=async(e,t,a)=>{let l=new FormData;l.append("file",e);try{await o.A.post("".concat(d,"/excel/dynamic"),l,{headers:{"Content-Type":"multipart/form-data"}}),a("✅ ตรวจสอบข้อมูลเรียบร้อย ไม่มีข้อผิดพลาด"),t([])}catch(e){if(e.response){let a=e.response.data;t(a.errors?a.errors:[a.message||"เกิดข้อผิดพลาด"])}else console.error("Error:",e.message),t(["❌ เกิดข้อผิดพลาดในการอัปโหลดไฟล์"])}},i=async(e,t,a,l)=>{let s=new FormData;s.append("file",e),s.append("headers",t);try{await o.A.post("".concat(d,"/excel/headers"),s,{headers:{"Content-Type":"multipart/form-data"}}),l("✅ ตรวจสอบข้อมูลเรียบร้อย ไม่มีข้อผิดพลาด"),a([])}catch(e){if(e.response){let t=e.response.data;a(t.errors?t.errors:[t.message||"เกิดข้อผิดพลาด"])}else console.error("Error:",e.message),a(["❌ เกิดข้อผิดพลาดในการอัปโหลดไฟล์"])}},m=async(e,t,a,l,s)=>{let r=new FormData;r.append("file",e),r.append("condition",JSON.stringify(t)),r.append("calculater",JSON.stringify(a));try{let e=await o.A.post("".concat(d,"/excel/template"),r,{headers:{"Content-Type":"multipart/form-data"}});200===e.status&&(s("✅ อัปโหลดไฟล์สำเร็จ! ตรวจสอบข้อมูลเรียบร้อย ไม่มีข้อผิดพลาด"),l([]))}catch(e){if(e.response){let t=e.response.data;l(t.errors?t.errors:[t.message||"เกิดข้อผิดพลาด"])}else console.error("Error:",e.message),l(["❌ เกิดข้อผิดพลาดในการอัปโหลดไฟล์"])}};var x=a(7660);let h=e=>{e((JSON.parse(localStorage.getItem("templates"))||[]).map(e=>e.templatename||"Unnamed Template"))},u=(e,t,a)=>{let l=(JSON.parse(localStorage.getItem("templates"))||[]).find(t=>t.templatename===e);l?(t(l.maxRows),a(l.headers.map(e=>e.condition))):t(null)};var p=a(9254),b=a.n(p),g=a(8003);let j=async(e,t,a)=>{let l=new(b()).Workbook,s=l.addWorksheet("Summary");s.columns=[{width:10},{width:80}];let r=s.addRow(["ลำดับ","ข้อผิดพลาด"]);r.height=25,r.eachCell(e=>{e.font={bold:!0},e.alignment={horizontal:"center",vertical:"middle"}});let n=e.filter(e=>void 0!==e.errorDetails).flatMap(e=>e.errorDetails);console.log("Error Details:",n),n.forEach((e,t)=>{s.addRow([t+1,e.trim()])});let o=l.addWorksheet("Data");o.columns=t.map(()=>({width:40}));let d=o.addRow(t);d.height=25,d.eachCell(e=>{e.font={bold:!0},e.alignment={horizontal:"center",vertical:"middle"}}),a.forEach(e=>{o.addRow(e)});let c=e.flatMap(e=>e.errorList?e.errorList:[e]).filter(e=>void 0!==e.row&&void 0!==e.column);console.log(c),c.forEach(e=>{let{row:t,column:a}=e,l=o.getRow(t+1);if(l){let e=l.getCell(a+1);e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFF0000"}},e.border={top:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}}});let i=new Blob([await l.xlsx.writeBuffer()],{type:"application/octet-stream"});(0,g.saveAs)(i,"error_report.xlsx")},f=()=>{let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)([]),[o,d]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[g,f]=(0,r.useState)(""),[y,N]=(0,r.useState)(!1),[v,w]=(0,r.useState)("noTopic"),[k,C]=(0,r.useState)(""),[S,E]=(0,r.useState)(""),[T,F]=(0,r.useState)([]),[R,A]=(0,r.useState)(null),[O,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{h(F)},[]),(0,r.useEffect)(()=>{f(""),u(S,A,_)},[S]),(0,r.useEffect)(()=>{S&&w("noTopic")},[S]);let D=async()=>{if(!e){b(["กรุณาเลือกไฟล์ Excel"]);return}if(R&&o.length>R){b(["จำนวนแถวข้อมูลของ template ไม่สามารถเกิน ".concat(R," แถวได้")]);return}f(""),N(!0);try{await c(e,b,f),s.oR.success("\uD83C\uDF89 อัปโหลดไฟล์สำเร็จ!",{position:"bottom-right",autoClose:3e3})}catch(e){console.error("Error uploading file:",e),s.oR.error("❌ การอัปโหลดล้มเหลว!",{position:"bottom-right",autoClose:3e3})}finally{N(!1)}},z=async()=>{if(!e){b(["กรุณาเลือกไฟล์ Excel"]);return}if("withTopic"===v&&!k){b(["กรุณาเลือกหัวข้อที่ต้องการตรวจสอบ"]);return}if(R&&o.length>R){b(["จำนวนแถวข้อมูลไม่สามารถเกิน ".concat(R," แถวได้")]);return}f(""),N(!0);try{"withTopic"===v?await i(e,k,b,f):await c(e,b,f)}catch(e){console.error("Error uploading file:",e)}finally{N(!1)}},L=async()=>{var t;if(!e){b(["กรุณาเลือกไฟล์ Excel"]);return}if(R&&o.length>R){b(["จำนวนแถวข้อมูลไม่สามารถเกิน ".concat(R," แถวได้")]);return}let l=(JSON.parse(localStorage.getItem("templates"))||[]).find(e=>e.templatename===S);if(!l){b(["ไม่พบข้อมูลเทมเพลต"]);return}let r=l.headers.map(e=>e.condition),n=l.headers.map(e=>e.name),d=((null===(t=l.condition)||void 0===t?void 0:t.calculations)||[]).map(e=>[e.type,e.addend,e.operand,e.result]),c=a.map(e=>e.toLowerCase()),i=n.map(e=>e.toLowerCase()).filter(e=>!c.includes(e));if(a.length!==r.length){b(["จำนวนคอลัมน์ในไฟล์ Excel ต้องเท่ากับจำนวนเงื่อนไขในเทมเพลต (".concat(r.length," คอลัมน์)")]);return}if(i.length>0){b(["ไม่พบคอลัมน์ในไฟล์ Excel ที่ตรงกับชื่อในเทมเพลต: ".concat(i.join(", "))]);return}f(""),N(!0);try{await m(e,r,d,b,f),s.oR.success("\uD83C\uDF89 อัปโหลดไฟล์สำเร็จ!",{position:"bottom-right",autoClose:3e3})}catch(e){console.error("Error uploading file:",e),s.oR.error("❌ การอัปโหลดล้มเหลว!",{position:"bottom-right",autoClose:3e3})}finally{N(!1)}console.log("Errors:",p.errorDetails)};return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,l.jsxs)("div",{className:"max-w-md w-full mx-auto p-6 bg-white shadow-lg rounded-lg kanit-regular",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold text-center mb-6 text-gray-800",children:"\uD83D\uDCC2 ตรวจสอบข้อมูลไฟล์ Excel"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex flex-col column items-start mb-2",children:[(0,l.jsx)("label",{htmlFor:"template",className:"block text-sm font-medium text-gray-700 mb-2",children:"เลือกเทมเพลตที่ใช้ตรวจสอบ:"}),(0,l.jsxs)("select",{id:"template",value:S,onChange:e=>E(e.target.value||""),className:"block w-full mt-1 text-sm border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 mb-2",children:[(0,l.jsx)("option",{value:"",children:"-- เลือกเทมเพลต --"}),T.map((e,t)=>(0,l.jsx)("option",{value:e,children:e},t))]})]}),S&&O.length>0&&(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:O.map((e,t)=>(0,l.jsx)("span",{className:"inline-block bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm",children:e},t))})}),""===S&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ตัวเลือกการอัปโหลด:"}),(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("input",{type:"radio",id:"noTopic",name:"uploadOption",value:"noTopic",checked:"noTopic"===v,onChange:e=>w(e.target.value),className:"mr-2"}),(0,l.jsx)("label",{htmlFor:"noTopic",className:"text-sm text-gray-700",children:"ส่งไฟล์ให้ตรวจสอบ"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",id:"withTopic",name:"uploadOption",value:"withTopic",checked:"withTopic"===v,onChange:e=>w(e.target.value),className:"mr-2"}),(0,l.jsx)("label",{htmlFor:"withTopic",className:"text-sm text-gray-700",children:"เลือกหัวข้อก่อนตรวจสอบไฟล์"})]})]})]}),"withTopic"===v&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{htmlFor:"header",className:"block text-sm font-medium text-gray-700",children:"เลือกหัวข้อที่ต้องการตรวจสอบ:"}),(0,l.jsxs)("select",{id:"header",value:k,onChange:e=>C(e.target.value),className:"block w-full mt-1 text-sm border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",children:[(0,l.jsx)("option",{value:"",children:"-- เลือกหัวข้อ --"}),a.map((e,t)=>(0,l.jsx)("option",{value:e,children:e},t))]})]}),(0,l.jsx)("input",{type:"file",accept:".xlsx, .xls",onChange:e=>{let a=e.target.files[0];if(t(a),b([]),f(""),n([]),d([]),a){let e=a.name.split(".").pop().toLowerCase();if("xlsx"!==e&&"xls"!==e){b(["กรุณาเลือกไฟล์ Excel ที่มีนามสกุล .xlsx หรือ .xls"]);return}let t=new FileReader;t.onload=e=>{let t=new Uint8Array(e.target.result),a=x.LF(t,{type:"array"}),l=a.SheetNames[0],s=a.Sheets[l],r=x.Wp.sheet_to_json(s,{header:1,defval:""});if(r.length>0){n(r[0]);let e=r.slice(1);e.length>0&&(console.log("จำนวนแถวข้อมูล:",e.length),e.forEach((e,t)=>{e.forEach((e,a)=>{""===e&&console.log("ช่องว่างในแถว ".concat(t+2,", คอลัมน์ ").concat(a))})})),d(e)}},t.readAsArrayBuffer(a)}},className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer mb-4 p-2"}),(0,l.jsx)("button",{onClick:S?L:"withTopic"===v?z:D,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-300",disabled:y,children:y?"กำลังอัปโหลด...":"อัปโหลดไฟล์"}),y&&(0,l.jsx)("div",{className:"mt-4 flex justify-center",children:(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),p.length>0?(0,l.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-lg p-6",children:[(0,l.jsxs)("h4",{className:"font-semibold text-lg mb-4 flex items-center text-red-600",children:[(0,l.jsx)("span",{className:"text-2xl mr-2",children:"❌"}),"พบข้อผิดพลาด:"]}),(0,l.jsx)("div",{className:"overflow-y-auto max-h-64",children:(0,l.jsxs)("table",{className:"min-w-full table-auto text-sm",children:[(0,l.jsx)("thead",{className:"bg-gray-200 sticky top-0 z-10",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"border px-4 py-2 text-left text-gray-600",children:"ลำดับ"}),(0,l.jsx)("th",{className:"border px-4 py-2 text-left text-gray-600",children:"ข้อผิดพลาด"})]})}),(0,l.jsx)("tbody",{children:p.map((e,t)=>"string"==typeof e?(0,l.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-4 py-2",children:t+1}),(0,l.jsx)("td",{className:"px-4 py-2",children:e})]},t):e.summary?e.errorDetails.map((e,a)=>(0,l.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-4 py-2",children:a+1}),(0,l.jsx)("td",{className:"px-4 py-2",children:e})]},"".concat(t,"-").concat(a))):void 0)})]})}),(0,l.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,l.jsx)("button",{onClick:()=>{j(p,a,o)},className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md",children:"ดาวน์โหลดรายงานข้อผิดพลาด"}),(0,l.jsx)("button",{onClick:()=>b([]),className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md",children:"ปิด"})]})]})}):g&&(0,l.jsx)("div",{className:"mt-6 p-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded-md",children:(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)("p",{children:g})})})]})})};a(7565);var y=a(9757),N=a(5055);let v=function(){return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("header",{className:"bg-blue-600 text-white shadow-md fixed top-0 z-50 w-full py-2 kanit-regular",children:(0,l.jsxs)("div",{className:"container mx-auto flex items-center justify-between px-4 py-3",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"bg-white text-green-600 p-1 rounded-full",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{d:"M19.5 2h-15A2.5 2.5 0 0 0 2 4.5v15A2.5 2.5 0 0 0 4.5 22h15a2.5 2.5 0 0 0 2.5-2.5v-15A2.5 2.5 0 0 0 19.5 2zm-6.4 12h-2.2L8 11l2.9-3h2.1L10 11zm3.9 0h1.7L15 11l2.1-3h-1.7L14 9.5z"})})}),(0,l.jsx)("span",{className:"text-lg font-semibold",children:"ExcelValidate"})]}),(0,l.jsxs)("nav",{className:"hidden md:flex space-x-6",children:[(0,l.jsxs)("a",{href:"/",className:"hover:text-blue-300 flex items-center",children:[(0,l.jsx)("i",{className:"fas fa-home mr-2"})," หน้าแรก"]}),(0,l.jsxs)(n.N_,{to:"/template",className:"hover:text-blue-300 flex items-center",children:[(0,l.jsx)(y.g,{icon:N.h8M,className:"mr-2"}),"เทมเพลต"]}),(0,l.jsxs)("a",{href:"#about",className:"hover:text-blue-300 flex items-center",children:[(0,l.jsx)("i",{className:"fas fa-info-circle mr-2"})," คำแนะนำการใช้งาน"]})]}),(0,l.jsx)("div",{className:"md:hidden",children:(0,l.jsx)("button",{className:"text-white focus:outline-none",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16m-7 6h7"})})})})]})})})},w=()=>(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(v,{}),(0,l.jsx)("main",{className:"relative",children:(0,l.jsx)(n.sv,{})})]});var k=a(3697);let C=()=>{let e=(0,n.Zp)(),[t,a]=(0,r.useState)([{name:"",condition:""}]),[s,o]=(0,r.useState)(null),[d,c]=(0,r.useState)(!1),[i,m]=(0,r.useState)(!1),[h,u]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)("template"),[w,C]=(0,r.useState)(10),[S,E]=(0,r.useState)(""),[T,F]=(0,r.useState)(null),[R,A]=(0,r.useState)([]),[O,_]=(0,r.useState)({}),D=[{value:"name",label:"ตรวจสอบชื่อ"},{value:"email",label:"ตรวจสอบอีเมล"},{value:"phone",label:"ตรวจสอบเบอร์โทร"},{value:"address",label:"ตรวจสอบที่อยู่"},{value:"citizenid",label:"ตรวจสอบบัตรประชาชน"},{value:"age",label:"ตรวจสอบอายุ"},{value:"gender",label:"ตรวจสอบเพศ"},{value:"balance",label:"ตรวจสอบเกี่ยวกับการเงิน"}],z=()=>{let e=localStorage.getItem("userToken");return e||(e=(0,k.A)(),localStorage.setItem("userToken",e)),e},L=async()=>{if(!f.trim()){alert("กรุณากรอกชื่อ Template");return}let e={userToken:z(),templatename:f,headers:t,maxRows:w,condition:{calculations:R||[]}},a=JSON.parse(localStorage.getItem("templates"))||[];a.push(e),localStorage.setItem("templates",JSON.stringify(a)),console.log("Sending template:",e);try{let t=await fetch("https://backend-excel-cagd.onrender.com/api/save/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();t.ok?(alert("บันทึกข้อมูลเรียบร้อยแล้ว!"),c(!1)):alert("Error: ".concat(a.message))}catch(e){console.error("Error saving template:",e),alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}},I=e=>{u(!1),"calculation"===e?b(!0):"column-condition"===e&&j(!0)},J=e=>{a(t.filter((t,a)=>a!==e)),s===e&&o(null)},M=(e,l,s)=>{let r=[...t];r[e][l]=s,a(r)},W=e=>{A(R.filter((t,a)=>a!==e))},B=(e,t)=>{("addend"!==t||O.operand!==e&&O.result!==e)&&("operand"!==t||O.addend!==e&&O.result!==e)&&("result"!==t||O.addend!==e&&O.operand!==e)&&_(a=>({...a,[t]:a[t]===e?null:e}))},H=()=>{for(let e=0;e<t.length;e++){let a=t[e];if(!a.name.trim())return alert("กรุณากรอกชื่อ Header ในบรรทัดที่ ".concat(e+1)),!1;if(!a.condition.trim())return alert("กรุณาเลือกเงื่อนไขในบรรทัดที่ ".concat(e+1)),!1;if(t.filter(e=>e.name===a.name).length>1)return alert("ชื่อ Header ในบรรทัดที่ ".concat(e+1," ซ้ำกัน")),!1}return!0},q=(e,t)=>{let a=e.map(e=>e.name),l=x.Wp.aoa_to_sheet([a]),s=x.Wp.book_new();x.Wp.book_append_sheet(s,l,"Template"),x._h(s,"".concat(t,".xlsx"))},U=e=>{v(e.target.value)};return(0,l.jsxs)("div",{className:"container mx-auto p-6 pt-28",children:[(0,l.jsxs)("div",{className:"flex mb-6",children:[(0,l.jsx)("button",{onClick:()=>e("/template"),className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"กลับ"}),(0,l.jsx)("h1",{className:"ml-8 text-2xl font-bold",children:"สร้างเทมเพลตใหม่"})]}),(0,l.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,l.jsxs)("div",{className:"w-full md:w-1/2",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold mb-6 flex items-center gap-2",children:[(0,l.jsx)(y.g,{icon:N.OQW,className:"text-blue-500 w-6 h-6"}),"เพิ่มหัวข้อคอลัมน์"]}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),H()&&c(!0)},children:[t.map((e,t)=>(0,l.jsx)("div",{className:"mb-4",children:s!==t&&e.name&&e.condition?(0,l.jsxs)("button",{type:"button",className:"w-full text-left px-4 py-2 bg-white border rounded-md shadow-md hover:bg-gray-100 transition flex items-center gap-3",onClick:()=>o(t),children:[(0,l.jsx)("span",{className:"bg-blue-500 text-white px-3 py-1 rounded-md text-sm font-semibold",children:t+1}),(0,l.jsx)("span",{children:e.name})]}):(0,l.jsxs)("div",{className:"bg-white p-4 border rounded-md shadow-md",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"ชื่อ Header"}),(0,l.jsx)("button",{type:"button",onClick:()=>J(t),className:"text-red-500 text-xs",children:"ลบ"})]}),(0,l.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-md p-2 mt-2",value:e.name,onChange:e=>M(t,"name",e.target.value),placeholder:"กรอกชื่อ Header"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ชื่อ Header จะถูกใช้เป็นชื่อคอลัมน์ในไฟล์ Excel"}),(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mt-4",children:"เงื่อนไข"}),(0,l.jsxs)("select",{className:"w-full border border-gray-300 rounded-md p-2 mt-2",value:e.condition,onChange:e=>M(t,"condition",e.target.value),children:[(0,l.jsx)("option",{value:"",children:"เลือกเงื่อนไข"}),D.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["เลือกเงื่อนไขที่เหมาะสม เช่น"," ",(0,l.jsx)("span",{title:"ตัวอย่าง: John Doe",children:"ตรวจสอบชื่อ"})," หรือ"," ",(0,l.jsx)("span",{title:"ตัวอย่าง: example@example.com",children:"ตรวจสอบอีเมล"})]}),(0,l.jsx)("button",{type:"button",className:"mt-4 px-4 py-2 rounded-md text-white ".concat(e.name.trim()&&e.condition?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"),onClick:()=>{e.name.trim()&&e.condition?o(null):alert("กรุณากรอกข้อมูลให้ครบทั้งสองช่องก่อนบันทึก")},disabled:!e.name.trim()||!e.condition,children:"บันทึก"})]})},t)),(0,l.jsx)("button",{type:"button",onClick:()=>{a([...t,{name:"",condition:""}]),o(t.length)},className:"bg-gray-200 text-gray-700 rounded-md px-4 py-2 hover:bg-gray-300",children:"เพิ่ม Header"}),t.length>1&&(0,l.jsx)("button",{type:"button",onClick:e=>{F(e),u(!0)},className:"ml-4 bg-gray-200 text-gray-700 rounded-md px-4 py-2 hover:bg-gray-300",children:"Option"}),(0,l.jsxs)("div",{className:"flex justify-end mt-6",children:[(0,l.jsx)("button",{type:"button",onClick:()=>c(!0),className:"mr-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"บันทึก Template"}),(0,l.jsx)("button",{type:"button",onClick:()=>m(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"ดาวน์โหลดไฟล์"})]})]})]}),(0,l.jsxs)("div",{className:"w-full md:w-1/2",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold mb-6 flex items-center gap-2",children:[(0,l.jsx)(y.g,{icon:N.h8M,className:"text-green-500 w-6 h-6"}),"ข้อมูลเทมเพลต"]}),(0,l.jsxs)("div",{className:"border border-gray-300 p-4 rounded-md overflow-x-auto",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold",children:"หัวข้อคอลัมน์:"}),(0,l.jsx)("div",{className:"w-full flex flex-wrap gap-2",children:t.map((e,t)=>(0,l.jsxs)("div",{className:"w-full md:w-auto flex flex-col border rounded-md mt-1 p-2 bg-gray-100",children:[(0,l.jsx)("span",{className:"font-semibold",children:e.name}),(0,l.jsx)("span",{className:"text-gray-700",children:e.condition})]},t))}),R&&R.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold",children:"เงื่อนไขการคำนวณ:"}),(0,l.jsx)("ul",{className:"list-disc pl-5 text-sm md:text-base",children:R.map((e,t)=>(0,l.jsx)("li",{className:"mt-1",children:"".concat(e.addend," ").concat(e.type," ").concat(e.operand," = ").concat(e.result)},t))})]})]})]})]}),i&&(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/3",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"ตั้งชื่อไฟล์"}),(0,l.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-md p-2 mb-4",value:f,onChange:U,placeholder:"กรุณากรอกชื่อไฟล์"}),(0,l.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,l.jsx)("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md",children:"ยกเลิก"}),(0,l.jsx)("button",{type:"button",onClick:()=>{q(t,f),c(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"ดาวน์โหลดไฟล์"})]})]})}),h&&(()=>{let e=t.filter(e=>"balance"===e.condition);return(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-lg w-96",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-4",children:"เลือกตัวเลือก"}),(0,l.jsx)("button",{className:"w-full py-2 px-4 rounded-md mb-2 transition \n                        ".concat(e.length>=3?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-400 text-gray-700 cursor-not-allowed"),onClick:()=>I("calculation"),disabled:e.length<3,children:"ฟังก์ชันการคำนวณ"}),(0,l.jsx)("button",{className:"w-full py-2 px-4 bg-green-500 text-white rounded-md hover:bg-green-600",onClick:()=>I("column-condition"),children:"เพิ่มเงื่อนไขคอลัมน์สัมพันธ์กัน"}),(0,l.jsx)("button",{className:"w-full mt-4 py-2 px-4 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",onClick:()=>u(!1),children:"ปิด"})]})})})(),p&&(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-xl md:max-w-2xl overflow-y-auto max-h-[80vh]",children:[(0,l.jsxs)("h3",{className:"text-xl font-semibold mb-4 text-center",children:["เลือกเงื่อนไขสำหรับ ",null==T?void 0:T.name]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เลือกคอลัมน์ที่จะคำนวณ"}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:t.filter(e=>"balance"===e.condition).map(e=>(0,l.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-gray-100 rounded-md shadow-md",children:[(0,l.jsx)("h4",{className:"text-center font-medium text-gray-700",children:e.name}),(0,l.jsx)("button",{onClick:()=>B(e.name,"addend"),className:"px-4 py-2 rounded-md shadow-sm border \n                                                    ".concat(O.addend===e.name?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-blue-200","\n                                                    transition"),children:"ตัวตั้ง (Addend)"}),(0,l.jsx)("button",{onClick:()=>B(e.name,"operand"),className:"px-4 py-2 rounded-md shadow-sm border \n                                                    ".concat(O.operand===e.name?"bg-yellow-600 text-white":"bg-white text-gray-700 hover:bg-yellow-200","\n                                                    transition"),children:"ตัวกระทำ (Operand)"}),(0,l.jsx)("button",{onClick:()=>B(e.name,"result"),className:"px-4 py-2 rounded-md shadow-sm border \n                                                    ".concat(O.result===e.name?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-green-200","\n                                                    transition"),children:"คอลัมน์ผลลัพธ์ (Result)"})]},e.name))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เลือกประเภทการคำนวณ"}),(0,l.jsxs)("select",{value:S,onChange:e=>{E(e.target.value)},className:"w-full border border-gray-300 rounded-md p-2",children:[(0,l.jsx)("option",{value:"",children:"เลือกประเภทการคำนวณ"}),(0,l.jsx)("option",{value:"+",children:"บวก"}),(0,l.jsx)("option",{value:"-",children:"ลบ"}),(0,l.jsx)("option",{value:"x",children:"คูณ"}),(0,l.jsx)("option",{value:"/",children:"หาร"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เงื่อนไขการคำนวณ"}),(0,l.jsx)("input",{type:"text",value:"".concat(O.addend," ").concat(S," ").concat(O.operand," = ").concat(O.result),onChange:e=>A(e.target.value),className:"w-full border border-gray-300 rounded-md p-2",placeholder:"เช่น ".concat(O.addend," ").concat(S," ").concat(O.operand," = ").concat(O.result)}),R.length>0&&(0,l.jsxs)("div",{className:"mt-4 mb-6",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold",children:"เงื่อนไขที่เพิ่มเข้ามา:"}),(0,l.jsx)("ul",{className:"list-disc pl-5",children:R.map((e,t)=>(0,l.jsxs)("li",{className:"flex justify-between items-center",children:["".concat(e.addend," ").concat(e.type," ").concat(e.operand," = ").concat(e.result),(0,l.jsx)("button",{onClick:()=>W(t),className:"ml-2 text-red-600 hover:text-red-800",children:"ลบ"})]},t))})]})]}),(0,l.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,l.jsx)("button",{onClick:()=>{if(!S||!O.addend||!O.operand||!O.result){alert("กรุณากรอกค่าทั้งหมด");return}let e={type:S,addend:O.addend,operand:O.operand,result:O.result};if(R.some(t=>t.addend===e.addend&&t.type===e.type&&t.operand===e.operand&&t.result===e.result)){alert("เงื่อนไขนี้ถูกเพิ่มไปแล้ว");return}A(t=>[...t,e]),E(""),_({addend:"",operand:"",result:""})},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"เพิ่มเงื่อนไข"}),(0,l.jsx)("button",{onClick:()=>{b(!1),F(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"ปิด"})]})]})]})}),g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex justify-center items-center",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-lg w-96",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-4",children:"เพิ่มเงื่อนไขคอลัมน์สัมพันธ์กัน"}),(0,l.jsx)("p",{children:"⚠️ ตั้งค่าเงื่อนไขที่ต้องการ เช่น หาก Column A มีค่า → Column B ต้องมีค่า"}),(0,l.jsx)("button",{className:"w-full mt-4 py-2 px-4 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",onClick:()=>j(!1),children:"ปิด"})]})}),d&&(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-1/3",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"ตั้งชื่อ Template"}),(0,l.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-md p-2 mb-4",value:f,onChange:U,placeholder:"กรุณากรอกชื่อ Template"}),(0,l.jsx)("label",{htmlFor:"maxRows",className:"block text-sm font-medium text-gray-700 mb-2",children:"จำนวนแถวสูงสุด:"}),(0,l.jsx)("input",{type:"number",id:"maxRows",className:"w-full border border-gray-300 rounded-md p-2 mt-2",value:w,onChange:e=>C(Number(e.target.value)),min:"1"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"กำหนดจำนวนแถวสูงสุดที่เทมเพลตสามารถรองรับได้"}),(0,l.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,l.jsx)("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md",children:"ยกเลิก"}),(0,l.jsx)("button",{type:"button",onClick:L,className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"บันทึก"})]})]})})]})},S="https://backend-excel-cagd.onrender.com/api/save/templates",E=async e=>{try{return(await o.A.get("".concat(S,"/").concat(e))).data}catch(e){return console.error("❌ Error fetching templates:",e),null}},T=async(e,t)=>{try{return(await o.A.delete("".concat(S,"/").concat(e,"/").concat(t))).data}catch(e){return console.error("❌ Error deleting template:",e),null}},F=async(e,t,a)=>{try{return(await o.A.put("".concat(S,"/").concat(e,"/").concat(t),a)).data}catch(e){return console.error("❌ Error updating template:",e),null}},R=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!1),[o,d]=(0,r.useState)(null),[c,i]=(0,r.useState)({templatename:"",headers:[],maxRows:""}),[m,x]=(0,r.useState)(localStorage.getItem("userToken")||""),[h,u]=(0,r.useState)(!0),p=(0,n.Zp)();(0,r.useEffect)(()=>{(async()=>{if(!m){console.error("User token not found"),u(!1);return}u(!0);let e=await E(m);e&&t(e.templates||[]),u(!1)})()},[m]);let b=async a=>{try{if(await T(m,a)){let l=e.filter(e=>e.templatename!==a);t(l)}}catch(e){console.error("Error deleting template:",e)}},g=e=>{d(e),i({...e}),s(!0)},j=async()=>{try{let a=await F(m,o.templatename,c);if(a){let l=e.map(e=>e.templatename===o.templatename?a:e);t(l)}s(!1)}catch(e){console.error("Error saving template edit:",e)}},f=(e,t,a)=>{let l=[...c.headers];l[e][t]=a,i({...c,headers:l})};return(0,l.jsxs)("div",{className:"container mx-auto p-6 pt-28",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsxs)("h1",{className:"text-2xl font-bold",children:[(0,l.jsx)(y.g,{icon:N.h8M,className:"mr-2"}),"จัดการเทมเพลต"]}),(0,l.jsx)("button",{onClick:()=>{p("/createtemplate")},className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600",children:"เพิ่มเทมเพลต"})]}),h?(0,l.jsx)("p",{className:"text-gray-500",children:"กำลังโหลดข้อมูล..."}):0===e.length?(0,l.jsx)("p",{className:"text-gray-500",children:"ไม่มีเทมเพลตที่บันทึก"}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"table-auto w-full border-collapse border border-gray-200",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-gray-100",children:[(0,l.jsx)("th",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:"ชื่อเทมเพลต"}),(0,l.jsx)("th",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:"ชื่อ Header"}),(0,l.jsx)("th",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:"เงื่อนไข"}),(0,l.jsx)("th",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:"จำนวน Row"}),(0,l.jsx)("th",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:"จัดการ"})]})}),(0,l.jsx)("tbody",{children:e.map((e,t)=>(0,l.jsxs)("tr",{className:"text-center",children:[(0,l.jsx)("td",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:e.templatename}),(0,l.jsx)("td",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:e.headers.map((e,t)=>(0,l.jsx)("span",{className:"inline-block bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-xs mr-1",children:e.name},t))}),(0,l.jsx)("td",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:e.headers.map((e,t)=>(0,l.jsx)("span",{className:"inline-block bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs mr-1",children:e.condition},t))}),(0,l.jsx)("td",{className:"border border-gray-300 px-2 sm:px-4 py-2",children:e.maxRows}),(0,l.jsxs)("td",{className:"border border-gray-300 px-2 sm:px-4 py-2 flex justify-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>g(e),className:"bg-blue-500 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-md hover:bg-blue-600 flex items-center",children:[(0,l.jsx)(y.g,{icon:N.MT7,className:"mr-1 sm:mr-2"}),"แก้ไข"]}),(0,l.jsxs)("button",{onClick:()=>b(e.templatename),className:"bg-red-500 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-md hover:bg-red-600 flex items-center",children:[(0,l.jsx)(y.g,{icon:N.BeE,className:"mr-1 sm:mr-2"}),"ลบ"]})]})]},t))})]})}),a&&(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center p-4",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-md w-full max-w-2xl",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"แก้ไขเทมเพลต"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ชื่อเทมเพลต"}),(0,l.jsx)("input",{type:"text",value:c.templatename,onChange:e=>i({...c,templatename:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-md"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"จำนวน Row"}),(0,l.jsx)("input",{type:"number",value:c.maxRows,onChange:e=>i({...c,maxRows:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-md"})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"เงื่อนไขการตรวจสอบ"}),c.headers.map((e,t)=>(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"ชื่อคอลัมน์"}),(0,l.jsx)("input",{type:"text",className:"w-full border border-gray-300 rounded-md px-4 py-2",value:e.name,onChange:e=>f(t,"name",e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"เงื่อนไข"}),(0,l.jsxs)("select",{className:"w-full border border-gray-300 rounded-md px-4 py-2",value:e.condition,onChange:e=>f(t,"condition",e.target.value),children:[(0,l.jsx)("option",{value:"",children:"เลือกเงื่อนไข"}),(0,l.jsx)("option",{value:"name",children:"ตรวจสอบชื่อ"}),(0,l.jsx)("option",{value:"email",children:"ตรวจสอบอีเมล"}),(0,l.jsx)("option",{value:"phone",children:"ตรวจสอบเบอร์โทร"}),(0,l.jsx)("option",{value:"address",children:"ตรวจสอบที่อยู่"}),(0,l.jsx)("option",{value:"citizenid",children:"ตรวจสอบบัตรประชาชน"}),(0,l.jsx)("option",{value:"age",children:"ตรวจสอบอายุ"}),(0,l.jsx)("option",{value:"gender",children:"ตรวจสอบเพศ"}),(0,l.jsx)("option",{value:"balance",children:"ตรวจสอบเกี่ยวกับการเงิน"})]})]})]},t))]}),(0,l.jsxs)("div",{className:"flex flex-col md:flex-row justify-end gap-2",children:[(0,l.jsx)("button",{onClick:j,className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 w-full md:w-auto",children:"บันทึก"}),(0,l.jsx)("button",{onClick:()=>{s(!1),i({templatename:"",headers:[],maxRows:""})},className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 w-full md:w-auto",children:"ยกเลิก"})]})]})})]})},A=()=>{let[e,t]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{t(!0)},[]),e)?(0,l.jsx)(n.I9,{children:(0,l.jsx)(n.BV,{children:(0,l.jsxs)(n.qh,{path:"/",element:(0,l.jsx)(w,{}),children:[(0,l.jsx)(n.qh,{index:!0,element:(0,l.jsx)(f,{})}),(0,l.jsx)(n.qh,{path:"/template",element:(0,l.jsx)(R,{})}),(0,l.jsx)(n.qh,{path:"/createtemplate",element:(0,l.jsx)(C,{})})]})})}):null};function O(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A,{}),(0,l.jsx)(s.N9,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[292,524,40,266,343,133,441,517,358],()=>t(2682)),_N_E=e.O()}]);